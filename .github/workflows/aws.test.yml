name: AWS Test

on:
  push:
    branches:
      - main
      - 'testing/*'

env:
  AWS_REGION: ap-south-1
  AWS_ROLE_MATRIX: '{"main": "DEV_AWS_ROLE_ARN", "testing/": "QA_AWS_ROLE_ARN"}'

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        branch: [main, testing/]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Configure AWS Credentials
        id: configure-aws-credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: ${{ secrets[env.AWS_ROLE_MATRIX[matrix.branch]] }}
          aws-region: ${{ env.AWS_REGION }}
          mask-aws-account-id: 'no'
        if: startsWith(github.ref, 'refs/heads/') && env.AWS_ROLE_MATRIX[matrix.branch]

      - name: List S3 Buckets
        run: aws s3 ls
